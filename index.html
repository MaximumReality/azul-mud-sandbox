<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Azul & Mochkil MUD Sandbox</title>

<style>
  body {
    background: #0a0a23;
    color: #00ffff;
    font-family: monospace;
    margin: 0;
    padding: 0;
    text-shadow: 0 0 6px #00ffff, 0 0 12px #00ffff;
  }

  .container {
    max-width: 420px;
    margin: auto;
    padding: 12px 12px 80px 12px;
    position: relative;
  }

  h1 {
    margin-top: 80px;
    text-align: center;
    color: #ffcc00;
    text-shadow: 0 0 6px #ffcc00, 0 0 12px #ffcc00, 0 0 20px #ffdd33;
  }

  #story {
    min-height: 120px;
    margin: 10px 0;
    position: relative;
    z-index: 10;
    color: #00ffff;
    text-shadow: 0 0 4px #00ffff, 0 0 8px #00ffff;
  }

  #loading, #dice {
    color: #ff66cc;
    text-shadow: 0 0 6px #ff66cc, 0 0 12px #ff66cc;
  }

  #actions button {
    display: block;
    width: 100%;
    margin: 4px 0;
    padding: 10px;
    font-size: 1.1em;
    background: #111144;
    color: #fff;
    border: 1px solid #00ffff;
    border-radius: 4px;
    text-shadow: 0 0 2px #00ffff;
  }

  #actions button:hover {
    background: #3333aa;
    box-shadow: 0 0 12px #00ffff;
  }

  #inventory {
    margin-top: 8px;
    position: relative;
    z-index: 20;
    color: #ffcc66;
    text-shadow: 0 0 6px #ffcc66, 0 0 12px #ffcc66;
  }

  #inputRow {
    display: flex;
    gap: 6px;
    margin-top: 10px;
    position: relative;
    z-index: 20;
  }

  #inputRow input {
    flex: 1;
    padding: 8px;
    font-size: 1em;
    background: #111133;
    color: #00ffff;
    border: 1px solid #00ffff;
    border-radius: 4px;
  }

  #inputRow button {
    background: #333366;
    color: #fff;
    border: 1px solid #00ffff;
    border-radius: 4px;
    padding: 8px 12px;
    font-size: 1em;
  }

  img.sprite {
    position: absolute;
    width: 64px;
    image-rendering: pixelated;
    z-index: 5;
    transition: all 0.3s ease;
  }

  #azul { top: 10px; left: 10px; animation: glow 2s infinite; }
  #mochkil { bottom: 20px; right: 10px; animation: glow 2s infinite alternate; }

  @keyframes glow {
    0%, 100% { filter: drop-shadow(0 0 4px #00ffff); }
    50% { filter: drop-shadow(0 0 12px #00ffff); }
  }
</style>
</head>

<body>
<div class="container">

  <img id="azul" class="sprite" src="https://raw.githubusercontent.com/MaximumReality/azul-story-cyoa-sandbox/main/azul.png">
  <img id="mochkil" class="sprite" src="https://raw.githubusercontent.com/MaximumReality/azul-story-cyoa-sandbox/main/mochkil.png">

  <h1>Azul & Mochkil MUD Sandbox</h1>

  <div id="story"></div>
  <div id="loading">ðŸ’¾ Reading adventure from disk...</div>
  <div id="dice">ðŸŽ²</div>
  <div id="actions"></div>
  <div id="inventory"></div>

  <div id="inputRow">
    <input id="userInput" placeholder="Enter command">
    <button id="sendBtn">Send</button>
  </div>

</div>

<script>
// ===== Adventure Rooms =====
const rooms = {
  lab: {
    description: "You are in the Glowing Lab. What will you do?",
    actions: [
      "Inspect test tubes",
      "Go to Secret Pantry",
      "Search glowing bookshelf"
    ]
  },
  pantry: {
    description: "You are in the Secret Pantry. Shelves overflow with cookies.",
    actions: [
      "Take cookie",
      "Return to Lab"
    ]
  },
  potionChamber: {
    description: "A hidden chamber filled with glowing potions.",
    actions: [
      "Take sparkling elixir",
      "Return to Lab"
    ]
  }
};

let currentRoom = 'lab';
let inventory = [];
let typing = false;

const storyEl = document.getElementById('story');
const actionsEl = document.getElementById('actions');
const inventoryEl = document.getElementById('inventory');
const userInput = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const loadingEl = document.getElementById('loading');
const mochkilEl = document.getElementById('mochkil');

// ===== Helpers =====
function showLoading(cb){
  loadingEl.style.display = 'block';
  setTimeout(()=>{
    loadingEl.style.display = 'none';
    if(cb) cb();
  }, 400);
}

function typeWriter(text, cb){
  if(typing) return;
  typing = true;
  storyEl.textContent = '';
  let i = 0;
  (function step(){
    if(i < text.length){
      storyEl.textContent += text[i++];
      setTimeout(step, 25);
    } else {
      typing = false;
      if(cb) cb();
    }
  })();
}

// ===== Render =====
function renderActions(){
  actionsEl.innerHTML = '';
  rooms[currentRoom].actions.forEach(a=>{
    const b = document.createElement('button');
    b.textContent = a;
    b.onclick = ()=>handleAction(a);
    actionsEl.appendChild(b);
  });
}

function renderRoom(){
  showLoading(()=>{
    typeWriter(rooms[currentRoom].description, ()=>{
      renderActions();
    });
  });
}

// ===== Mochkil Mischief =====
function mochkilChaos() {
  if(Math.random() < 0.4 && !typing) {
    typeWriter("Mochkil is being naughty!", ()=>{
      const containerWidth = document.querySelector('.container').clientWidth;
      const containerHeight = 350;

      const x = Math.random() * (containerWidth - 64);
      const y = Math.random() * (containerHeight - 64);

      mochkilEl.style.left = x + 'px';
      mochkilEl.style.top = y + 'px';
      
      if(Math.random() < 0.5 && actionsEl.children.length > 1){
        for(let i = actionsEl.children.length; i >= 0; i--){
          actionsEl.appendChild(actionsEl.children[Math.floor(Math.random()*i)]);
        }
      }
    });
  }
}

// ===== Actions =====
function handleAction(action){
  if(action.includes("Pantry")){
    currentRoom = 'pantry';
    renderRoom();
    mochkilChaos();
    return;
  }
  if(action.includes("bookshelf")){
    currentRoom = 'potionChamber';
    renderRoom();
    mochkilChaos();
    return;
  }
  if(action.includes("Return")){
    currentRoom = 'lab';
    renderRoom();
    mochkilChaos();
    return;
  }

  if(action.includes("Take cookie") && currentRoom==='pantry' && !inventory.includes("cookie")){
    inventory.push("cookie");
    updateInventory();
    typeWriter("You grab a cookie. Mochkil squeals happily!", mochkilChaos);
    return;
  }
  if(action.includes("Take sparkling elixir") && currentRoom==='potionChamber' && !inventory.includes("sparkling elixir")){
    inventory.push("sparkling elixir");
    updateInventory();
    typeWriter("You carefully grab the Sparkling Elixir. Azul hums approvingly!", mochkilChaos);
    return;
  }

  typeWriter(`You attempt to ${action}. Something happens.`, mochkilChaos);
}

// ===== Inventory =====
function updateInventory(){
  inventoryEl.textContent = "Inventory: " + (inventory.length ? inventory.join(', ') : 'None');
}

// ===== Input =====
sendBtn.onclick = ()=>{
  const v = userInput.value.trim();
  if(v) handleAction(v);
  userInput.value = '';
};

// ===== Init =====
renderRoom();
updateInventory();
</script>

</body>
</html>
