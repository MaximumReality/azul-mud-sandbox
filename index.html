<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Azul & Mochkil MUD Sandbox â€“ Godville Mode</title>

<style>
body {
  background: #0a0a23;
  color: #00ffff;
  font-family: monospace;
  margin: 0;
  padding: 0;
  text-shadow: 0 0 6px #00ffff, 0 0 12px #00ffff;
}

.container {
  max-width: 420px;
  margin: auto;
  padding: 12px 12px 80px 12px;
  position: relative;
}

h1 {
  margin-top: 80px;
  text-align: center;
  color: #ffcc00;
  text-shadow: 0 0 6px #ffcc00, 0 0 12px #ffcc00, 0 0 20px #ffdd33;
}

#story {
  min-height: 140px;
  margin: 10px 0;
  position: relative;
  z-index: 10;
  color: #00ffff;
  text-shadow: 0 0 4px #00ffff, 0 0 8px #00ffff;
}

#loading, #dice {
  color: #ff66cc;
  text-shadow: 0 0 6px #ff66cc, 0 0 12px #ff66cc;
}

#actions button {
  display: block;
  width: 100%;
  margin: 4px 0;
  padding: 10px;
  font-size: 1.1em;
  background: #111144;
  color: #fff;
  border: 1px solid #00ffff;
  border-radius: 4px;
  text-shadow: 0 0 2px #00ffff;
}

#actions button:hover {
  background: #3333aa;
  box-shadow: 0 0 12px #00ffff;
}

#inventory {
  margin-top: 8px;
  position: relative;
  z-index: 20;
  color: #ffcc66;
  text-shadow: 0 0 6px #ffcc66, 0 0 12px #ffcc66;
}

#inputRow {
  display: flex;
  gap: 6px;
  margin-top: 10px;
  position: relative;
  z-index: 20;
}

#inputRow input {
  flex: 1;
  padding: 8px;
  font-size: 1em;
  background: #111133;
  color: #00ffff;
  border: 1px solid #00ffff;
  border-radius: 4px;
}

#inputRow button {
  background: #333366;
  color: #fff;
  border: 1px solid #00ffff;
  border-radius: 4px;
  padding: 8px 12px;
  font-size: 1em;
}

img.sprite {
  position: absolute;
  width: 64px;
  image-rendering: pixelated;
  z-index: 5;
  transition: all 0.3s ease;
}

#azul { top: 10px; left: 10px; animation: glow 2s infinite; }
#mochkil { bottom: 20px; right: 10px; animation: glow 2s infinite alternate; }

@keyframes glow {
  0%, 100% { filter: drop-shadow(0 0 4px #00ffff); }
  50% { filter: drop-shadow(0 0 12px #00ffff); }
}
</style>
</head>

<body>
<div class="container">

  <img id="azul" class="sprite" src="https://raw.githubusercontent.com/MaximumReality/azul-story-cyoa-sandbox/main/azul.png">
  <img id="mochkil" class="sprite" src="https://raw.githubusercontent.com/MaximumReality/azul-story-cyoa-sandbox/main/mochkil.png">

  <h1>Azul & Mochkil MUD Sandbox â€“ Godville Mode</h1>

  <div id="story"></div>
  <div id="loading">ðŸ’¾ Reading adventure from disk...</div>
  <div id="dice">ðŸŽ²</div>
  <div id="actions"></div>
  <div id="inventory"></div>

  <div id="inputRow">
    <input id="userInput" placeholder="Enter command">
    <button id="sendBtn">Send</button>
  </div>

</div>

<script>
// ===== Adventure Rooms =====
const rooms = {
  lab: {
    description: "You are in the Glowing Lab. Test tubes bubble, strange liquids float mid-air.",
    actions: ["Inspect test tubes", "Go to Secret Pantry", "Search glowing bookshelf", "Go to Library", "Go to Courtyard"]
  },
  pantry: {
    description: "You are in the Secret Pantry. Shelves overflow with cookies.",
    actions: ["Take cookie", "Return to Lab", "Peek behind crates"]
  },
  potionChamber: {
    description: "A hidden chamber filled with glowing potions.",
    actions: ["Take sparkling elixir", "Return to Lab", "Drink random potion"]
  },
  library: {
    description: "Endless shelves of dusty books, some levitating mysteriously.",
    actions: ["Read a book", "Search for spell scroll", "Return to Lab"]
  },
  courtyard: {
    description: "A small courtyard with a fountain and glowing mushrooms.",
    actions: ["Pick a mushroom", "Throw coin in fountain", "Return to Lab"]
  },
  attic: {
    description: "A dark dusty attic. You hear squeaks.",
    actions: ["Search boxes", "Chase mouse", "Return to Lab"]
  }
};

let currentRoom = 'lab';
let inventory = [];
let typing = false;

const storyEl = document.getElementById('story');
const actionsEl = document.getElementById('actions');
const inventoryEl = document.getElementById('inventory');
const userInput = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const loadingEl = document.getElementById('loading');
const mochkilEl = document.getElementById('mochkil');

// ===== Helpers =====
function showLoading(cb){
  loadingEl.style.display = 'block';
  setTimeout(()=>{
    loadingEl.style.display = 'none';
    if(cb) cb();
  }, 400);
}

function typeWriter(text, cb){
  if(typing) return;
  typing = true;
  storyEl.textContent = '';
  let i = 0;
  (function step(){
    if(i < text.length){
      storyEl.textContent += text[i++];
      setTimeout(step, 25);
    } else {
      typing = false;
      if(cb) cb();
    }
  })();
}

// ===== Render =====
function renderActions(){
  actionsEl.innerHTML = '';
  rooms[currentRoom].actions.forEach(a=>{
    const b = document.createElement('button');
    b.textContent = a;
    b.onclick = ()=>handleAction(a);
    actionsEl.appendChild(b);
  });
}

function renderRoom(){
  showLoading(()=>{
    typeWriter(rooms[currentRoom].description, ()=>{
      renderActions();
    });
  });
}

// ===== Mochkil Mischief =====
function mochkilChaos() {
  if(Math.random() < 0.4 && !typing) {
    const containerWidth = document.querySelector('.container').clientWidth;
    const containerHeight = 350;
    const x = Math.random() * (containerWidth - 64);
    const y = Math.random() * (containerHeight - 64);

    mochkilEl.style.left = x + 'px';
    mochkilEl.style.top = y + 'px';
    
    if(Math.random() < 0.5 && actionsEl.children.length > 1){
      for(let i = actionsEl.children.length; i >= 0; i--){
        actionsEl.appendChild(actionsEl.children[Math.floor(Math.random() * i)]);
      }
    }
    
    const chaosMessages = [
      "Mochkil is plotting something...",
      "Mochkil looks bored. Very bored.",
      "Mochkil sits on a button. Oops!",
      "Azul rolls eyes at Mochkil's antics."
    ];
    
    typeWriter(chaosMessages[Math.floor(Math.random()*chaosMessages.length)]);
  }
}

// ===== Random Godville-style Comments =====
const randomComments = [
  "Mochkil glares at you. 'Really? THAT again?'",
  "Azul floats by: 'Are you even trying?'",
  "A floating test tube rolls past. 'Oops! Watch out!'",
  "Mochkil whispers: 'I hide your cookies. Forever.'",
  "Azul giggles: 'This potion smells like old cheese!'"
];

function randomNPCComment() {
  if(Math.random() < 0.3 && !typing){
    const comment = randomComments[Math.floor(Math.random() * randomComments.length)];
    typeWriter(comment);
  }
}

setInterval(randomNPCComment, 7000);

// ===== Actions =====
function handleAction(action){
  // Room navigation
  if(action.includes("Pantry")) { currentRoom='pantry'; renderRoom(); mochkilChaos(); return; }
  if(action.includes("bookshelf")) { currentRoom='potionChamber'; renderRoom(); mochkilChaos(); return; }
  if(action.includes("Return") || action.includes("Lab")) { currentRoom='lab'; renderRoom(); mochkilChaos(); return; }
  if(action.includes("Library")) { currentRoom='library'; renderRoom(); mochkilChaos(); return; }
  if(action.includes("Courtyard")) { currentRoom='courtyard'; renderRoom(); mochkilChaos(); return; }
  if(action.includes("Attic")) { currentRoom='attic'; renderRoom(); mochkilChaos(); return; }

  // Items
  if(action.includes("Take cookie") && currentRoom==='pantry' && !inventory.includes("cookie")){
    inventory.push("cookie");
    updateInventory();
    typeWriter("You grab a cookie. Mochkil squeals happily!", mochkilChaos);
    return;
  }
  if(action.includes("Take sparkling elixir") && currentRoom==='potionChamber' && !inventory.includes("sparkling elixir")){
    inventory.push("sparkling elixir");
    updateInventory();
    typeWriter("You carefully grab the Sparkling Elixir. Azul hums approvingly!", mochkilChaos);
    return;
  }
  if(action.includes("Drink random potion") && currentRoom==='potionChamber'){
    const effects = ["You glow like a neon sign! ðŸŒŸ","You hiccup rainbows ðŸŒˆ","You levitate for 5 seconds ðŸª‚"];
    const effect = effects[Math.floor(Math.random()*effects.length)];
    typeWriter(effect, mochkilChaos);
    return;
  }
  if(action.includes("Pick a mushroom") && currentRoom==='courtyard'){
    inventory.push("mushroom");
    updateInventory();
    typeWriter("You pick a glowing mushroom. Mochkil eyes it suspiciously.", mochkilChaos);
    return;
  }

  // Library fun
  if(action.includes("Read a book") && currentRoom==='library'){
    const jokes = [
      "You read a book. The book ignores you. Rude.",
      "Azul whispers: 'Try turning it off and on.'",
      "A tiny goblin pops out and says: 'Socks are better than shoes!'"
    ];
    typeWriter(jokes[Math.floor(Math.random()*jokes.length)], mochkilChaos);
    return;
  }
  if(action.includes("Search for spell scroll") && currentRoom==='library'){
    inventory.push("spell scroll");
    updateInventory();
    typeWriter("You find a spell scroll! Who knows what it does...", mochkilChaos);
    return;
  }

  // Attic fun
  if(action.includes("Search boxes") && currentRoom==='attic'){
    typeWriter("You rummage through dusty boxes. Mochkil hides in one. Classic.", mochkilChaos);
    return;
  }
  if(action.includes("Chase mouse") && currentRoom==='attic'){
    typeWriter("The mouse squeaks and Mochkil gives chase, knocking over a candle. Oops.", mochkilChaos);
    return;
  }

  // Default
  typeWriter(`You attempt to ${action}. Something happens.`, mochkilChaos);
}

// ===== Inventory =====
function updateInventory(){
  inventoryEl.textContent = "Inventory: " + (inventory.length ? inventory.join(', ') : 'None');
}

// ===== Input =====
sendBtn.onclick = ()=>{
  const v = userInput.value.trim();
  if(v) handleAction(v);
  userInput.value = '';
};

// ===== Init =====
renderRoom();
updateInventory();
</script>

</body>
</html>
